(function(){function q(m){function r(a,d,b,c){return a.slice(0,d)+(c||"")+a.slice(d+(+b||0))}function p(a){this.j=a}function t(a,d){if(!a)return null;var b=0,c=a;do{var e=c;if(c=c.firstChild){do{var f=c.textContent.length;if(b<=d&&b+f>d)break;b+=f}while(c=c.nextSibling)}if(!c)break}while(c&&c.hasChildNodes()&&3!=c.nodeType);if(c)return{element:c,offset:d-b};if(e){for(c=e;c&&c.lastChild;)c=c.lastChild;return 3===c.nodeType?{element:c,offset:c.textContent.length}:{element:c,offset:0}}return{element:a,offset:0,
error:!0}}function k(a){this.v=a;this.i=[];this.w=[]}function h(a,d){if(!(this instanceof h))return new h(a,d);d=d||{};"PRE"===a.tagName?this.h=a:(this.h=document.createElement("pre"),a.appendChild(this.h));var b=d.className||"";this.h.className="mdedit"+(b?" "+b:"");this.h.setAttribute("contenteditable",!0);b=this.f=document.createElement("div");b.innerHTML=this.h.innerHTML;this.h.innerHTML="";this.h.appendChild(b);this.c=new p(a);this.l=new k(this);l.bind(a,"cut",this.R.bind(this));l.bind(a,"paste",
this.W.bind(this));l.bind(a,"keyup",this.V.bind(this));l.bind(a,"input",this.m.bind(this));l.bind(a,"keydown",this.T.bind(this));l.bind(a,"keypress",this.U.bind(this));this.N=d.change||function(){};this.m()}var u={scalar:{pattern:/([\-:]\s*(![^\s]+)?[ \t]*[|>])[ \t]*(?:(\n[ \t]+)[^\r\n]+(?:\3[^\r\n]+)*)/,lookbehind:!0,alias:"string"},comment:/#[^\n]+/,key:{pattern:/(\s*[:\-,[{\n?][ \t]*(![^\s]+)?[ \t]*)[^\n{[\]},#]+?(?=\s*:\s)/,lookbehind:!0,alias:"atrule"},directive:{pattern:/((^|\n)[ \t]*)%[^\n]+/,
lookbehind:!0,alias:"important"},datetime:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(\d{4}-\d\d?-\d\d?([tT]|[ \t]+)\d\d?:\d{2}:\d{2}(\.\d*)?[ \t]*(Z|[-+]\d\d?(:\d{2})?)?|\d{4}-\d{2}-\d{2}|\d\d?:\d{2}(:\d{2}(\.\d*)?)?)(?=[ \t]*(\n|$|,|]|}))/,lookbehind:!0,alias:"number"},"boolean":{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(true|false)[ \t]*(?=\n|$|,|]|})/i,lookbehind:!0,alias:"important"},"null":{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(null|~)[ \t]*(?=\n|$|,|]|})/i,lookbehind:!0,alias:"important"},string:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)("(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*')(?=[ \t]*(\n|$|,|]|}))/,
lookbehind:!0},number:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)[+\-]?(0x[\dA-Fa-f]+|0o[0-7]+|(\d+\.?\d*|\.?\d+)(e[\+\-]?\d+)?|\.inf|\.nan)[ \t]*(?=\n|$|,|]|})/i,lookbehind:!0},tag:/![^\s]+/,important:/[&*][\w]+/,punctuation:/([:[\]{}\-,|>?]|---|\.\.\.)/},v=function(){function a(a,d){e[a]=c[a]=b[a]=d}function d(a,c){e[a]=b[a]=c}var b={comment:m.languages.markup.comment};b["front-matter"]={pattern:/^---\n[\s\S]*?\n---(?=\n|$)/,inside:{"marker front-matter-marker start":/^---/,"marker front-matter-marker end":/---$/,
rest:u}};var c={},e={},f={markup:["markup","html","xml"],javascript:["javascript","js"]},g;for(g in m.languages)if(m.languages.hasOwnProperty(g)){var h=m.languages[g];if("function"!==typeof h){var k=f[g];d("code-block fenced "+g,{pattern:new RegExp("(^ {0,3}|\\n {0,3})(([`~])\\3\\3) *("+(k?k.join("|"):g)+")( [^`\n]*)? *\\n(?:[\\s\\S]*?)\\n {0,3}(\\2\\3*(?= *\\n)|$)","gi"),lookbehind:!0,inside:{"code-language":{pattern:/(^([`~])\2+)((?!\2)[^\2\n])+/,lookbehind:!0},"marker code-fence start":/^([`~])\1+/,
"marker code-fence end":/([`~])\1+$/,"code-inner":{pattern:/(^\n)[\s\S]*(?=\n$)/,lookbehind:!0,alias:"language-"+g,inside:h}}})}}d("code-block fenced untagged",{pattern:/(^ {0,3}|\n {0,3})(([`~])\3\3)[^`\n]*\n(?:[\s\S]*?)\n {0,3}(\2\3*(?= *\n)|$)/g,lookbehind:!0,inside:{"code-language":{pattern:/(^([`~])\2+)((?!\2)[^\2\n])+/,lookbehind:!0},"marker code-fence start":/^([`~])\1+/,"marker code-fence end":/([`~])\1+$/,"code-inner":{pattern:/(^\n)[\s\S]*(?=\n$)/,lookbehind:!0}}});d("heading setext-heading heading-1",
{pattern:/^ {0,3}[^\s].*\n {0,3}=+[ \t]*$/gm,inside:{"marker heading-setext-line":{pattern:/^( {0,3}[^\s].*\n) {0,3}=+[ \t]*$/gm,lookbehind:!0},rest:c}});d("heading setext-heading heading-2",{pattern:/^ {0,3}[^\s].*\n {0,3}-+[ \t]*$/gm,inside:{"marker heading-setext-line":{pattern:/^( {0,3}[^\s].*\n) {0,3}-+[ \t]*$/gm,lookbehind:!0},rest:c}});f={"marker heading-hash start":/^ *#+ */,"marker heading-hash end":/ +#+ *$/,rest:c};for(g=1;6>=g;g+=1)d("heading heading-"+g,{pattern:new RegExp("^ {0,3}#{"+
g+"}(?![#\\S]).*$","gm"),inside:f});g={pattern:/^\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]/,inside:{"marker bracket start":/^\[/,"marker bracket end":/\]$/,"link-text-inner":{pattern:/[\w\W]+/,inside:c}}};var f={pattern:/\[(?:\\.|[^\]])*\]/,inside:{"marker bracket start":/^\[/,"marker bracket end":/\]$/,"link-label-inner":/[\w\W]+/}},h={pattern:/^!\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]/,inside:{"marker image-bang":/^!/,"marker bracket start":/^\[/,"marker bracket end":/\]$/,"image-text-inner":{pattern:/[\w\W]+/,
inside:c}}},k={pattern:/^(\s*)(?!<)(?:\\.|[^\(\)\s]|\([^\(\)\s]*\))+/,lookbehind:!0},n={pattern:/^(\s*)<(?:\\.|[^<>\n])*>/,lookbehind:!0,inside:{"marker brace start":/^</,"marker brace end":/>$/,"braced-href-inner":/[\w\W]+/}},l={pattern:/('(?:\\'|[^'])+'|"(?:\\"|[^"])+")\s*$/,inside:{"marker quote start":/^['"]/,"marker quote end":/['"]$/,"title-inner":/[\w\W]+/}},p={pattern:/\( *(?:(?!<)(?:\\.|[^\(\)\s]|\([^\(\)\s]*\))*|<(?:[^<>\n]|\\.)*>)( +('(?:[^']|\\')+'|"(?:[^"]|\\")+"))? *\)/,inside:{"marker bracket start":/^\(/,
"marker bracket end":/\)$/,"link-params-inner":{pattern:/[\w\W]+/,inside:{"link-title":l,href:k,"braced-href":n}}}};d("hr",{pattern:/^[\t ]*([*\-_])([\t ]*\1){2,}([\t ]*$)/gm,inside:{"marker hr-marker":/[*\-_]/g}});d("urldef",{pattern:/^( {0,3})\[(?:\\.|[^\]])+]: *\n? *(?:(?!<)(?:\\.|[^\(\)\s]|\([^\(\)\s]*\))*|<(?:[^<>\n]|\\.)*>)( *\n? *('(?:\\'|[^'])+'|"(?:\\"|[^"])+"))?$/gm,lookbehind:!0,inside:{"link-label":f,"marker urldef-colon":/^:/,"link-title":l,href:k,"braced-href":n}});d("blockquote",{pattern:/^[\t ]*>[\t ]?.+(?:\n(?!\n)|.)*/gm,
inside:{"marker quote-marker":/^[\t ]*>[\t ]?/gm,"blockquote-content":{pattern:/[^>]+/,inside:{rest:e}}}});d("list",{pattern:/^[\t ]*([*+\-]|\d+\.)[\t ].+(?:\n(?!\n)|.)*/gm,inside:{li:{pattern:/^[\t ]*([*+\-]|\d+\.)[\t ].+(?:\n|[ \t]+[^*+\- \t].*\n)*/gm,inside:{"marker list-item":/^[ \t]*([*+\-]|\d+\.)[ \t]/m,rest:e}}}});d("code-block indented",{pattern:/(^|(?:^|(?:^|\n)(?![ \t]*([*+\-]|\d+\.)[ \t]).*\n)\s*?\n)((?: {4}|\t).*(?:\n|$))+/g,lookbehind:!0});d("p",{pattern:/[^\n](?:\n(?!\n)|.)*[^\n]/g,
inside:c});a("image",{pattern:/(^|[^\\])!\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]\(\s*(?:(?!<)(?:\\.|[^\(\)\s]|\([^\(\)\s]*\))*|<(?:[^<>\n]|\\.)*>)(\s+('(?:[^']|\\')+'|"(?:[^"]|\\")+"))?\s*\)/,lookbehind:!0,inside:{"link-text":h,"link-params":p}});a("link",{pattern:/(^|[^\\])\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]\(\s*(?:(?!<)(?:\\.|[^\(\)\s]|\([^\(\)\s]*\))*|<(?:[^<>\n]|\\.)*>)(\s+('(?:[^']|\\')+'|"(?:[^"]|\\")+"))?\s*\)/,lookbehind:!0,inside:{"link-text":g,"link-params":p}});a("image image-ref",{pattern:/(^|[^\\])!\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\] ?\[(?:\\.|[^\]])*\]/,
lookbehind:!0,inside:{"link-text":h,"link-label":f}});a("link link-ref",{pattern:/(^|[^\\])\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\] ?\[(?:\\.|[^\]])*\]/,lookbehind:!0,inside:{"link-text":g,"link-label":f}});a("image image-ref shortcut-ref",{pattern:/(^|[^\\])!\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]/,lookbehind:!0,inside:{"marker image-bang":/^!/,"link-text":g}});a("link link-ref shortcut-ref",{pattern:/(^|[^\\])\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]/,lookbehind:!0,inside:{"link-text":g}});a("code",{pattern:/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/g,
lookbehind:!0,inside:{"marker code-marker start":/^`/,"marker code-marker end":/`$/,"code-inner":/[\w\W]+/}});a("strong",{pattern:/(^|[^\\*_]|\\[*_])([_\*])\2(?:\n(?!\n)|.)+?\2{2}(?!\2)/g,lookbehind:!0,inside:{"marker strong-marker start":/^(\*\*|__)/,"marker strong-marker end":/(\*\*|__)$/,"strong-inner":{pattern:/[\w\W]+/,inside:c}}});a("em",{pattern:/(^|[^\\*_]|\\[*_])(\*|_)(?:\n(?!\n)|.)+?\2(?!\2)/g,lookbehind:!0,inside:{"marker em-marker start":/^(\*|_)/,"marker em-marker end":/(\*|_)$/,"em-inner":{pattern:/[\w\W]+/,
inside:c}}});a("strike",{pattern:/(^|\n|(?!\\)\W)(~~)(?=\S)([^\r]*?\S)\2/gm,lookbehind:!0,inside:{"marker strike-marker start":/^~~/,"marker strike-marker end":/~~$/,"strike-inner":{pattern:/[\w\W]+/,inside:c}}});a("comment",m.languages.markup.comment);g=m.languages.markup.tag;a("tag",{pattern:new RegExp("(^|[^\\\\])"+g.pattern.source,"i"),lookbehind:!0,inside:g.inside});a("entity",m.languages.markup.entity);return b}(),l={bind:function(a,d,b){a.addEventListener(d,b,!1)}},w={newline:function(a){var d=
a.start,b=a.b.lastIndexOf("\n")+1,c=a.b.slice(b),e=c.match(/^\s*/)[0],f=e,g=!1;/^ {0,3}$/.test(e)&&(e=c.slice(e.length),/^[*+\-]\s+/.test(e)?(f+=e.match(/^[*+\-]\s+/)[0],g=/^[*+\-]\s+$/.test(e)):/^\d+\.\s+/.test(e)?(f+=e.match(/^\d+\.\s+/)[0].replace(/^\d+/,function(a){return+a+1}),g=/^\d+\.\s+$/.test(e)):/^>/.test(e)&&(f+=e.match(/^>\s*/)[0],g=/^>\s*$/.test(e)));f="\n"+f;e=a.g;a.g="";g&&(e=c+e,a.b=a.b.slice(0,b),a.start-=c.length,d-=c.length,f="\n");a.b+=f;a.start+=f.length;a.end=a.start;return{add:f,
a:e,start:d}},indent:function(a,d){var b=a.b.lastIndexOf("\n")+1;if(d.inverse)/\s/.test(a.b.charAt(b))&&(a.b=r(a.b,b,1),--a.start),a.g=a.g.replace(/\r?\n(?!\r?\n)\s/,"\n");else if(a.g||d.P)a.b=r(a.b,b,0,"\t"),a.g=a.g.replace(/\r?\n/,"\n\t"),a.start+=1;else return a.b+="\t",a.start+=1,a.end+=1,{add:"\t",a:"",start:a.start-1};a.end=a.start+a.g.length;return{action:"indent",start:a.start,end:a.end,inverse:d.inverse}},wrap:function(a,d){var b={"(":")","[":"]","{":"}","<":">"}[d.u]||d.u;a.b+=d.u;a.C=b+
a.C;a.start+=1;a.end+=1;return{add:d.u+a.g+b,a:a.g,start:a.start-1,end:a.end-1}}};p.prototype.o=function(){var a=getSelection();if(!a.rangeCount)return 0;var d=a.getRangeAt(0),b=a=d.startContainer,d=d.startOffset;if(!(this.j.compareDocumentPosition(a)&16))return 0;do{for(;a=a.previousSibling;)a.textContent&&(d+=a.textContent.length);a=b=b.parentNode}while(a&&a!==this.j);return d};p.prototype.s=function(){var a=getSelection();return a.rangeCount?this.o()+String(a.getRangeAt(0)).length:0};p.prototype.A=
function(a,d,b){var c=document.createRange(),e=t(this.j,a),f=e;if(d&&d!==a)f=t(this.j,d);else if(!1!==b){a=f.element;var g=f.offset;d=a.textContent;b=a.parentNode;var h=d.slice(0,g);a.textContent=d.slice(g);g=document.createTextNode(h);b.insertBefore(n,a);b.insertBefore(g,n);var h=n.offsetTop,k=n.offsetHeight,l=this.j.offsetHeight,m=this.j.scrollTop;a.textContent=d;b.removeChild(n);b.removeChild(g);0>h-m?this.j.scrollTop=h:h-m+k>l&&(this.j.scrollTop=h+k-l)}c.setStart(e.element,e.offset);c.setEnd(f.element,
f.offset);e=getSelection();e.removeAllRanges();e.addRange(c)};var n=document.createElement("span");n.style.position="absolute";n.innerHTML="|";k.prototype.action=function(a){this.i.length&&this.M(this.i[this.i.length-1],a)?this.i.push(this.O(this.i.pop(),a)):this.i.push(a);this.w=[]};k.prototype.M=function(a,d){return!a.action&&!d.action&&!Array.isArray(a)&&!Array.isArray(d)&&!(a.a&&d.add)&&!(a.add&&d.a)&&!(a.add&&!d.add)&&!(!a.add&&d.add)&&!(a.add&&a.a)&&!(d.add&&d.a)&&a.start+a.add.length===d.start+
d.a.length};k.prototype.O=function(a,d){return{add:a.add+d.add,a:d.a+a.a,start:Math.min(a.start,d.start)}};k.prototype.Y=function(){if(this.i.length){var a=this.i.pop();this.w.push(a);this.L(a)}};k.prototype.H=function(){if(this.w.length){var a=this.w.pop();this.i.push(a);this.apply(a)}};k.prototype.apply=function d(b){Array.isArray(b)?b.forEach(d.bind(this)):b.action?this.v.action(b.action,{inverse:b.inverse,start:b.start,end:b.end,G:!0}):this.v.apply(b)};k.prototype.L=function b(c){Array.isArray(c)?
c.forEach(b.bind(this)):c.action?this.v.action(c.action,{inverse:!c.inverse,start:c.start,end:c.end,G:!0}):this.v.apply({start:c.start,end:c.end,a:c.add,add:c.a})};h.prototype.S=function(){var b=this.f.textContent;this.K!==b&&(this.N(b),this.K=b)};h.prototype.setValue=function(b){this.D(b);this.m()};h.prototype.getValue=function(){return this.f.textContent};h.prototype.D=function(b){this.f.textContent=b};h.prototype.V=function(b){b=b&&b.keyCode||0;-1<[9,91,93,16,17,18,20,13,112,113,114,115,116,117,
118,119,120,121,122,123,27].indexOf(b)||-1===[33,34,35,36,37,39,38,40].indexOf(b)&&this.m()};h.prototype.m=function(){var b=this.f.textContent,c=this.c.o(),e=this.c.s();this.I();var f;b===this.J?this.f.innerHTML!==this.F&&(f=this.F):this.F=f=m.highlight(b,v);this.J=b;void 0!==f&&(/\n$/.test(b)||(f+="\n"),b=this.f.cloneNode(!1),b.innerHTML=f,this.h.replaceChild(b,this.f),this.f=b);this.X();null===c&&null===e||this.c.A(c,e);this.S()};h.prototype.I=function(){void 0===this.B&&(this.B=this.h.scrollTop);
setTimeout(function(){this.B=void 0}.bind(this),500)};h.prototype.X=function(){this.h.scrollTop=this.B;this.B=void 0};h.prototype.U=function(b){if(!b.metaKey&&!b.ctrlKey){var c=b.charCode;if(c){var e=this.c.o(),f=this.c.s(),c=String.fromCharCode(c);/[\[\{\(<"'~\*_]/.test(c)&&e!==f?(this.action("wrap",{u:c}),b.preventDefault()):this.l.action({add:c,a:e===f?"":this.f.textContent.slice(e,f),start:e})}}};h.prototype.T=function(b){var c=b.metaKey||b.ctrlKey;switch(b.keyCode){case 8:case 46:var c=this.c.o(),
e=this.c.s(),f=c===e?1:Math.abs(e-c),c=8===b.keyCode?e-f:c;this.l.action({add:"",a:this.f.textContent.slice(c,c+f),start:c});break;case 9:c||(this.action("indent",{inverse:b.shiftKey}),b.preventDefault());break;case 219:case 221:c&&!b.shiftKey&&(this.action("indent",{inverse:219===b.keyCode,P:!0}),b.preventDefault());break;case 13:this.action("newline");b.preventDefault();break;case 89:c&&(this.l.H(),b.preventDefault());break;case 90:c&&(b.shiftKey?this.l.H():this.l.Y(),b.preventDefault())}};h.prototype.apply=
function(b){this.D(r(this.f.textContent,b.start,b.a.length,b.add));this.c.A(b.start,b.start+b.add.length);this.m()};h.prototype.action=function(b,c){c=c||{};var e=this.f.textContent,f=c.start||this.c.o(),g=c.end||this.c.s(),e={start:f,end:g,b:e.slice(0,f),C:e.slice(g),g:e.slice(f,g)},f=w[b](e,c);this.I();this.D(e.b+e.g+e.C);f&&!c.G&&this.l.action(f);this.c.A(e.start,e.end,!1);this.m()};h.prototype.R=function(){var b=this.c.o(),c=this.c.s();b!==c&&this.l.action({add:"",a:this.f.textContent.slice(b,
c),start:b})};h.prototype.W=function(b){var c=this.c.o(),e=this.c.s(),e=c===e?"":this.f.textContent.slice(c,e);b.clipboardData&&(b.preventDefault(),b=b.clipboardData.getData("text/plain"),this.apply({add:b,a:e,start:c}),this.l.action({add:b,a:e,start:c}),c+=b.length,this.c.A(c,c),this.m())};return h}"function"===typeof define&&define.amd?define(["prismjs"],q):"object"===typeof exports?module.exports=q(require("prismjs")):this.mdEdit=q(this.Prism);})();
